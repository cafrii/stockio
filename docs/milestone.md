# 프로젝트 마일스톤

본 문서는 stockio_prd.md의 개발 일정을 더 세부화한 것입니다.

---

## Phase 1: MVP (현재가 조회 기능)

### Phase 1.0: PoC 검증 및 프로젝트 초기화
- [x] 키움증권 REST API 연동 검증 (PoC 완료)
  - 인증 및 토큰 관리
  - 차트 데이터 조회 (일봉/분봉/틱)
- [ ] 프로젝트 구조 설계
  - 디렉토리 구조 확정
  - requirements.txt 작성
  - 개발 환경 설정 (.env, .gitignore)

**산출물**: 프로젝트 구조 문서, requirements.txt

---

### Phase 1.1: 핵심 기능 구현
- [ ] FastAPI 프로젝트 초기화
  - main.py 생성
  - Health check 엔드포인트 (`/health`)
- [ ] 키움 API 클라이언트 모듈 (`app/services/kiwoom.py`)
  - 토큰 관리 (PoC 코드 재사용)
  - 시세 조회 함수 구현
- [ ] `/api/price` 엔드포인트 구현 (`app/api/routes.py`)
  - Query 파라미터 검증 (종목코드, 시장구분)
  - 키움 API 호출
- [ ] XML 변환 로직 (`app/utils/xml_builder.py`)
  - 시세 데이터 → XML 변환
  - 에러 응답 XML 생성

**산출물**: 핵심 API 코드

---

### Phase 1.2: 단위 시험
- [ ] 키움 API 클라이언트 테스트
  - 토큰 발급 정상 동작
  - 시세 조회 정상 동작
  - API 에러 처리 (잘못된 종목 코드 등)
- [ ] XML 변환 테스트
  - 정상 데이터 변환
  - 에러 응답 변환

**시험 방법**: pytest를 사용한 자동화 테스트 (선택) 또는 수동 테스트
**산출물**: 테스트 결과 기록 (간단한 로그/문서)

---

### Phase 1.3: 로컬 E2E 테스트
- [ ] 로컬 서버 실행 및 직접 API 호출 테스트
  - curl/Postman으로 `/api/price` 테스트
  - 다양한 종목 코드 검증 (삼성전자, 카카오, ETF 등)
  - 에러 케이스 검증 (잘못된 코드, 빈 파라미터 등)
- [ ] Google Spreadsheet 연동 테스트
  - IMPORTXML 함수로 로컬 서버 호출
  - 실제 시세 데이터 표시 확인

**시험 방법**: 수동 테스트
**산출물**: 테스트 시나리오 및 결과 기록

---

### Phase 1.4: 배포
- [ ] 배포 준비
  - requirements.txt 최종 확인
  - .env 환경 변수 정리
  - README 작성 (배포 방법 포함)
- [ ] Render 배포
  - GitHub Repository 연동
  - 환경 변수 설정 (KIWOOM_API_APPKEY, KIWOOM_API_SECRET)
  - 자동 배포 설정
- [ ] 배포 후 검증
  - Health check 확인
  - Google Spreadsheet에서 실제 배포 서버 호출 테스트

**산출물**: 배포된 서비스 URL, 배포 가이드

---

## Phase 2: 안정화 및 개선

### Phase 2.1: 캐싱 및 성능 개선
- [ ] 인메모리 캐싱 구현 (`app/core/cache.py`)
  - TTL 5분 설정
  - 캐시 키: `{종목코드}_{시장구분}`
- [ ] Rate Limiting 고려
  - 요청 간 최소 간격 설정 (200ms)

**산출물**: 캐싱 로직 코드

---

### Phase 2.2: 에러 처리 및 로깅 강화
- [ ] 에러 처리 개선
  - HTTP 상태 코드별 XML 응답 표준화
  - 키움 API 장애 시 재시도 로직 (최대 3회)
- [ ] 로깅 시스템 구축 (`app/utils/logger.py`)
  - 요청/응답 로그
  - 에러 로그
  - API 호출 횟수 로그

**산출물**: 에러 처리 및 로깅 코드

---

### Phase 2.3: E2E 검증
- [ ] 프로덕션 환경 종합 테스트
  - 100개 종목 동시 조회 테스트
  - 장 시간/장 외 시간 동작 확인
  - 캐시 히트율 확인
  - 에러 발생률 모니터링
- [ ] 모니터링 대시보드 검토 (선택 사항)

**시험 방법**: 수동 테스트 + 로그 분석
**산출물**: 테스트 리포트

---

## Phase 3: 확장 (선택 사항)

### Phase 3.1: 추가 데이터 항목 지원
- [ ] 시고저종, 등락률, 거래량 등 추가
- [ ] XML 스키마 확장

### Phase 3.2: 다른 자산 클래스 지원
- [ ] KRX 금 현물 시세
- [ ] 암호화폐 (비트코인, 이더리움)

### Phase 3.3: 성능 최적화
- [ ] 비동기 처리 개선
- [ ] 외부 캐시 (Redis) 검토

**산출물**: 확장 기능 설계 문서 및 코드

---

## 테스트 전략 요약

본 프로젝트의 난이도는 높지 않으므로, 다음과 같이 균형있게 시험을 진행합니다:

1. **단위 시험** (Phase 1.2)
   - 핵심 모듈만 테스트 (키움 API 클라이언트, XML 변환)
   - pytest 자동화는 선택 사항, 수동 테스트도 가능

2. **E2E 시험** (Phase 1.3, Phase 2.3)
   - Phase 1.3: 로컬 환경에서 기본 동작 확인
   - Phase 2.3: 프로덕션 환경에서 종합 검증

3. **회귀 테스트**
   - Phase 2 이후 변경 사항 발생 시, 핵심 시나리오만 재테스트

---

## 현재 진행 상황

- [x] Phase 1.0: PoC 검증 및 프로젝트 초기화 (완료 ✅)
- [x] Phase 1.1: 핵심 기능 구현 (완료 ✅)
- [x] Phase 1.2: 단위 시험 (완료 ✅)
- [ ] Phase 1.3: 로컬 E2E 테스트 (다음 단계)

**다음 단계**: Phase 1.3의 로컬 E2E 테스트 시작
